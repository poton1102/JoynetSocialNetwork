{"ast":null,"code":"import { deleteDataAPI, getDataAPI, postDataAPI } from \"../../utils/fetchData\";\nimport { DeleteData, GLOBALTYPES } from \"./globalTypes\";\nexport const MESS_TYPES = {\n  ADD_USER: 'ADD_USER',\n  ADD_MESSAGE: 'ADD_MESSAGE',\n  GET_CONVERSATIONS: 'GET_CONVERSATIONS',\n  GET_MESSAGES: 'GET_MESSAGES',\n  UPDATE_MESSAGES: 'UPDATE_MESSAGES',\n  DELETE_MESSAGES: 'DELETE_MESSAGES',\n  DELETE_CONVERSATION: 'DELETE_CONVERSATION',\n  CHECK_ONLINE_OFFLINE: 'CHECK_ONLINE_OFFLINE'\n};\n// export const addUser = ({ user, message }) => dispatch => {\n//     //kiểm tra user._id trong mảng message.users có khác user._id trong mảng vừa search được hay hay không?\n//     //Nếu add vào chat rồi thì thôi, tránh lặp lại add vào chat 2 lần\n//     if (message.users.every(item => item._id !== user._id)) {\n//         dispatch({ type: MESS_TYPES.ADD_USER, payload: { ...user, text: '', media: [] } })\n//     }\n// }\n\nexport const addMessage = _ref => {\n  let {\n    msg,\n    auth,\n    socket\n  } = _ref;\n  return async dispatch => {\n    // console.log(msg)\n    dispatch({\n      type: MESS_TYPES.ADD_MESSAGE,\n      payload: msg\n    });\n    const {\n      _id,\n      avatar,\n      fullname,\n      username\n    } = auth.user;\n    socket.emit('addMessage', {\n      ...msg,\n      user: {\n        _id,\n        avatar,\n        fullname,\n        username\n      }\n    });\n    try {\n      await postDataAPI('message', msg, auth.token);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const getConversations = _ref2 => {\n  let {\n    auth,\n    page = 1\n  } = _ref2;\n  return async dispatch => {\n    try {\n      const res = await getDataAPI(`conversations?limit=${page * 9}`, auth.token);\n      let newArr = [];\n      res.data.conversations.forEach(item => {\n        //lọc ra thằng auth.user._id, ko cho add chính nó vào đoạn hội thoại\n        item.recipients.forEach(cv => {\n          if (cv._id !== auth.user._id) {\n            newArr.push({\n              ...cv,\n              text: item.text,\n              media: item.media,\n              call: item.call\n            });\n            // newArr.push({ cv })\n          }\n        });\n      });\n      // console.log(newArr)\n      dispatch({\n        type: MESS_TYPES.GET_CONVERSATIONS,\n        payload: {\n          newArr,\n          result: res.data.result\n        }\n      });\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const getMessages = _ref3 => {\n  let {\n    auth,\n    id,\n    page = 1\n  } = _ref3;\n  return async dispatch => {\n    try {\n      const res = await getDataAPI(`message/${id}?limit=${page * 9}`, auth.token);\n      // console.log(res)\n      const newData = {\n        ...res.data,\n        messages: res.data.messages.reverse()\n      };\n      // console.log(newData)\n      dispatch({\n        type: MESS_TYPES.GET_MESSAGES,\n        payload: {\n          ...newData,\n          _id: id,\n          page\n        }\n      });\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const loadMoreMessages = _ref4 => {\n  let {\n    auth,\n    id,\n    page = 1\n  } = _ref4;\n  return async dispatch => {\n    try {\n      const res = await getDataAPI(`message/${id}?limit=${page * 9}`, auth.token);\n      const newData = {\n        ...res.data,\n        messages: res.data.messages.reverse()\n      };\n      dispatch({\n        type: MESS_TYPES.UPDATE_MESSAGES,\n        payload: {\n          ...newData,\n          _id: id,\n          page\n        }\n      });\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const deleteMessages = _ref5 => {\n  let {\n    msg,\n    data,\n    auth\n  } = _ref5;\n  return async dispatch => {\n    const newData = DeleteData(data, msg._id);\n    console.log(newData);\n    dispatch({\n      type: MESS_TYPES.DELETE_MESSAGES,\n      payload: {\n        newData,\n        _id: msg.recipient\n      }\n    });\n    try {\n      await deleteDataAPI(`message/${msg._id}`, auth.token);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};\nexport const deleteConversation = _ref6 => {\n  let {\n    auth,\n    id\n  } = _ref6;\n  return async dispatch => {\n    dispatch({\n      type: MESS_TYPES.DELETE_CONVERSATION,\n      payload: id\n    });\n    try {\n      await deleteDataAPI(`conversation/${id}`, auth.token);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};","map":{"version":3,"names":["deleteDataAPI","getDataAPI","postDataAPI","DeleteData","GLOBALTYPES","MESS_TYPES","ADD_USER","ADD_MESSAGE","GET_CONVERSATIONS","GET_MESSAGES","UPDATE_MESSAGES","DELETE_MESSAGES","DELETE_CONVERSATION","CHECK_ONLINE_OFFLINE","addMessage","_ref","msg","auth","socket","dispatch","type","payload","_id","avatar","fullname","username","user","emit","token","err","ALERT","error","response","data","getConversations","_ref2","page","res","newArr","conversations","forEach","item","recipients","cv","push","text","media","call","result","getMessages","_ref3","id","newData","messages","reverse","loadMoreMessages","_ref4","deleteMessages","_ref5","console","log","recipient","deleteConversation","_ref6"],"sources":["D:/JoynetSocialNetwork/do-an-fe/src/redux/actions/messageAction.js"],"sourcesContent":["import { deleteDataAPI, getDataAPI, postDataAPI } from \"../../utils/fetchData\"\r\nimport { DeleteData, GLOBALTYPES } from \"./globalTypes\"\r\n\r\nexport const MESS_TYPES = {\r\n    ADD_USER: 'ADD_USER',\r\n    ADD_MESSAGE: 'ADD_MESSAGE',\r\n    GET_CONVERSATIONS: 'GET_CONVERSATIONS',\r\n    GET_MESSAGES: 'GET_MESSAGES',\r\n    UPDATE_MESSAGES: 'UPDATE_MESSAGES',\r\n    DELETE_MESSAGES: 'DELETE_MESSAGES',\r\n    DELETE_CONVERSATION: 'DELETE_CONVERSATION',\r\n    CHECK_ONLINE_OFFLINE: 'CHECK_ONLINE_OFFLINE'\r\n\r\n}\r\n// export const addUser = ({ user, message }) => dispatch => {\r\n//     //kiểm tra user._id trong mảng message.users có khác user._id trong mảng vừa search được hay hay không?\r\n//     //Nếu add vào chat rồi thì thôi, tránh lặp lại add vào chat 2 lần\r\n//     if (message.users.every(item => item._id !== user._id)) {\r\n//         dispatch({ type: MESS_TYPES.ADD_USER, payload: { ...user, text: '', media: [] } })\r\n//     }\r\n// }\r\n\r\nexport const addMessage = ({ msg, auth, socket }) => async dispatch => {\r\n    // console.log(msg)\r\n    dispatch({ type: MESS_TYPES.ADD_MESSAGE, payload: msg })\r\n    const { _id, avatar, fullname, username } = auth.user\r\n    socket.emit('addMessage', { ...msg, user: { _id, avatar, fullname, username } })\r\n    try {\r\n        await postDataAPI('message', msg, auth.token);\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err.response.data.msg } })\r\n    }\r\n}\r\n\r\nexport const getConversations = ({ auth, page = 1 }) => async (dispatch) => {\r\n    try {\r\n        const res = await getDataAPI(`conversations?limit=${page * 9}`, auth.token)\r\n\r\n        let newArr = []\r\n        res.data.conversations.forEach(item => {\r\n            //lọc ra thằng auth.user._id, ko cho add chính nó vào đoạn hội thoại\r\n            item.recipients.forEach(cv => {\r\n                if (cv._id !== auth.user._id) {\r\n                    newArr.push({ ...cv, text: item.text, media: item.media, call: item.call })\r\n                    // newArr.push({ cv })\r\n                }\r\n            })\r\n        })\r\n        // console.log(newArr)\r\n        dispatch({ type: MESS_TYPES.GET_CONVERSATIONS, payload: { newArr, result: res.data.result } })\r\n    }\r\n    catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err.response.data.msg } })\r\n    }\r\n}\r\n\r\nexport const getMessages = ({ auth, id, page = 1 }) => async (dispatch) => {\r\n    try {\r\n        const res = await getDataAPI(`message/${id}?limit=${page * 9}`, auth.token)\r\n        // console.log(res)\r\n        const newData = { ...res.data, messages: res.data.messages.reverse() }\r\n        // console.log(newData)\r\n        dispatch({ type: MESS_TYPES.GET_MESSAGES, payload: { ...newData, _id: id, page } })\r\n    }\r\n    catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err.response.data.msg } })\r\n    }\r\n}\r\n\r\nexport const loadMoreMessages = ({ auth, id, page = 1 }) => async (dispatch) => {\r\n    try {\r\n        const res = await getDataAPI(`message/${id}?limit=${page * 9}`, auth.token)\r\n        const newData = { ...res.data, messages: res.data.messages.reverse() }\r\n\r\n        dispatch({ type: MESS_TYPES.UPDATE_MESSAGES, payload: { ...newData, _id: id, page } })\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err.response.data.msg } })\r\n    }\r\n}\r\nexport const deleteMessages = ({ msg, data, auth }) => async (dispatch) => {\r\n    const newData = DeleteData(data, msg._id)\r\n    console.log(newData)\r\n    dispatch({ type: MESS_TYPES.DELETE_MESSAGES, payload: { newData, _id: msg.recipient } })\r\n    try {\r\n        await deleteDataAPI(`message/${msg._id}`, auth.token)\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err.response.data.msg } })\r\n    }\r\n}\r\n\r\nexport const deleteConversation = ({ auth, id }) => async (dispatch) => {\r\n\r\n    dispatch({ type: MESS_TYPES.DELETE_CONVERSATION, payload: id })\r\n    try {\r\n        await deleteDataAPI(`conversation/${id}`, auth.token)\r\n    } catch (err) {\r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: { error: err.response.data.msg } })\r\n    }\r\n}\r\n"],"mappings":"AAAA,SAASA,aAAa,EAAEC,UAAU,EAAEC,WAAW,QAAQ,uBAAuB;AAC9E,SAASC,UAAU,EAAEC,WAAW,QAAQ,eAAe;AAEvD,OAAO,MAAMC,UAAU,GAAG;EACtBC,QAAQ,EAAE,UAAU;EACpBC,WAAW,EAAE,aAAa;EAC1BC,iBAAiB,EAAE,mBAAmB;EACtCC,YAAY,EAAE,cAAc;EAC5BC,eAAe,EAAE,iBAAiB;EAClCC,eAAe,EAAE,iBAAiB;EAClCC,mBAAmB,EAAE,qBAAqB;EAC1CC,oBAAoB,EAAE;AAE1B,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,MAAMC,UAAU,GAAGC,IAAA;EAAA,IAAC;IAAEC,GAAG;IAAEC,IAAI;IAAEC;EAAO,CAAC,GAAAH,IAAA;EAAA,OAAK,MAAMI,QAAQ,IAAI;IACnE;IACAA,QAAQ,CAAC;MAAEC,IAAI,EAAEf,UAAU,CAACE,WAAW;MAAEc,OAAO,EAAEL;IAAI,CAAC,CAAC;IACxD,MAAM;MAAEM,GAAG;MAAEC,MAAM;MAAEC,QAAQ;MAAEC;IAAS,CAAC,GAAGR,IAAI,CAACS,IAAI;IACrDR,MAAM,CAACS,IAAI,CAAC,YAAY,EAAE;MAAE,GAAGX,GAAG;MAAEU,IAAI,EAAE;QAAEJ,GAAG;QAAEC,MAAM;QAAEC,QAAQ;QAAEC;MAAS;IAAE,CAAC,CAAC;IAChF,IAAI;MACA,MAAMvB,WAAW,CAAC,SAAS,EAAEc,GAAG,EAAEC,IAAI,CAACW,KAAK,CAAC;IACjD,CAAC,CAAC,OAAOC,GAAG,EAAE;MACVV,QAAQ,CAAC;QAAEC,IAAI,EAAEhB,WAAW,CAAC0B,KAAK;QAAET,OAAO,EAAE;UAAEU,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACjB;QAAI;MAAE,CAAC,CAAC;IACpF;EACJ,CAAC;AAAA;AAED,OAAO,MAAMkB,gBAAgB,GAAGC,KAAA;EAAA,IAAC;IAAElB,IAAI;IAAEmB,IAAI,GAAG;EAAE,CAAC,GAAAD,KAAA;EAAA,OAAK,MAAOhB,QAAQ,IAAK;IACxE,IAAI;MACA,MAAMkB,GAAG,GAAG,MAAMpC,UAAU,CAAE,uBAAsBmC,IAAI,GAAG,CAAE,EAAC,EAAEnB,IAAI,CAACW,KAAK,CAAC;MAE3E,IAAIU,MAAM,GAAG,EAAE;MACfD,GAAG,CAACJ,IAAI,CAACM,aAAa,CAACC,OAAO,CAACC,IAAI,IAAI;QACnC;QACAA,IAAI,CAACC,UAAU,CAACF,OAAO,CAACG,EAAE,IAAI;UAC1B,IAAIA,EAAE,CAACrB,GAAG,KAAKL,IAAI,CAACS,IAAI,CAACJ,GAAG,EAAE;YAC1BgB,MAAM,CAACM,IAAI,CAAC;cAAE,GAAGD,EAAE;cAAEE,IAAI,EAAEJ,IAAI,CAACI,IAAI;cAAEC,KAAK,EAAEL,IAAI,CAACK,KAAK;cAAEC,IAAI,EAAEN,IAAI,CAACM;YAAK,CAAC,CAAC;YAC3E;UACJ;QACJ,CAAC,CAAC;MACN,CAAC,CAAC;MACF;MACA5B,QAAQ,CAAC;QAAEC,IAAI,EAAEf,UAAU,CAACG,iBAAiB;QAAEa,OAAO,EAAE;UAAEiB,MAAM;UAAEU,MAAM,EAAEX,GAAG,CAACJ,IAAI,CAACe;QAAO;MAAE,CAAC,CAAC;IAClG,CAAC,CACD,OAAOnB,GAAG,EAAE;MACRV,QAAQ,CAAC;QAAEC,IAAI,EAAEhB,WAAW,CAAC0B,KAAK;QAAET,OAAO,EAAE;UAAEU,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACjB;QAAI;MAAE,CAAC,CAAC;IACpF;EACJ,CAAC;AAAA;AAED,OAAO,MAAMiC,WAAW,GAAGC,KAAA;EAAA,IAAC;IAAEjC,IAAI;IAAEkC,EAAE;IAAEf,IAAI,GAAG;EAAE,CAAC,GAAAc,KAAA;EAAA,OAAK,MAAO/B,QAAQ,IAAK;IACvE,IAAI;MACA,MAAMkB,GAAG,GAAG,MAAMpC,UAAU,CAAE,WAAUkD,EAAG,UAASf,IAAI,GAAG,CAAE,EAAC,EAAEnB,IAAI,CAACW,KAAK,CAAC;MAC3E;MACA,MAAMwB,OAAO,GAAG;QAAE,GAAGf,GAAG,CAACJ,IAAI;QAAEoB,QAAQ,EAAEhB,GAAG,CAACJ,IAAI,CAACoB,QAAQ,CAACC,OAAO,CAAC;MAAE,CAAC;MACtE;MACAnC,QAAQ,CAAC;QAAEC,IAAI,EAAEf,UAAU,CAACI,YAAY;QAAEY,OAAO,EAAE;UAAE,GAAG+B,OAAO;UAAE9B,GAAG,EAAE6B,EAAE;UAAEf;QAAK;MAAE,CAAC,CAAC;IACvF,CAAC,CACD,OAAOP,GAAG,EAAE;MACRV,QAAQ,CAAC;QAAEC,IAAI,EAAEhB,WAAW,CAAC0B,KAAK;QAAET,OAAO,EAAE;UAAEU,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACjB;QAAI;MAAE,CAAC,CAAC;IACpF;EACJ,CAAC;AAAA;AAED,OAAO,MAAMuC,gBAAgB,GAAGC,KAAA;EAAA,IAAC;IAAEvC,IAAI;IAAEkC,EAAE;IAAEf,IAAI,GAAG;EAAE,CAAC,GAAAoB,KAAA;EAAA,OAAK,MAAOrC,QAAQ,IAAK;IAC5E,IAAI;MACA,MAAMkB,GAAG,GAAG,MAAMpC,UAAU,CAAE,WAAUkD,EAAG,UAASf,IAAI,GAAG,CAAE,EAAC,EAAEnB,IAAI,CAACW,KAAK,CAAC;MAC3E,MAAMwB,OAAO,GAAG;QAAE,GAAGf,GAAG,CAACJ,IAAI;QAAEoB,QAAQ,EAAEhB,GAAG,CAACJ,IAAI,CAACoB,QAAQ,CAACC,OAAO,CAAC;MAAE,CAAC;MAEtEnC,QAAQ,CAAC;QAAEC,IAAI,EAAEf,UAAU,CAACK,eAAe;QAAEW,OAAO,EAAE;UAAE,GAAG+B,OAAO;UAAE9B,GAAG,EAAE6B,EAAE;UAAEf;QAAK;MAAE,CAAC,CAAC;IAC1F,CAAC,CAAC,OAAOP,GAAG,EAAE;MACVV,QAAQ,CAAC;QAAEC,IAAI,EAAEhB,WAAW,CAAC0B,KAAK;QAAET,OAAO,EAAE;UAAEU,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACjB;QAAI;MAAE,CAAC,CAAC;IACpF;EACJ,CAAC;AAAA;AACD,OAAO,MAAMyC,cAAc,GAAGC,KAAA;EAAA,IAAC;IAAE1C,GAAG;IAAEiB,IAAI;IAAEhB;EAAK,CAAC,GAAAyC,KAAA;EAAA,OAAK,MAAOvC,QAAQ,IAAK;IACvE,MAAMiC,OAAO,GAAGjD,UAAU,CAAC8B,IAAI,EAAEjB,GAAG,CAACM,GAAG,CAAC;IACzCqC,OAAO,CAACC,GAAG,CAACR,OAAO,CAAC;IACpBjC,QAAQ,CAAC;MAAEC,IAAI,EAAEf,UAAU,CAACM,eAAe;MAAEU,OAAO,EAAE;QAAE+B,OAAO;QAAE9B,GAAG,EAAEN,GAAG,CAAC6C;MAAU;IAAE,CAAC,CAAC;IACxF,IAAI;MACA,MAAM7D,aAAa,CAAE,WAAUgB,GAAG,CAACM,GAAI,EAAC,EAAEL,IAAI,CAACW,KAAK,CAAC;IACzD,CAAC,CAAC,OAAOC,GAAG,EAAE;MACVV,QAAQ,CAAC;QAAEC,IAAI,EAAEhB,WAAW,CAAC0B,KAAK;QAAET,OAAO,EAAE;UAAEU,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACjB;QAAI;MAAE,CAAC,CAAC;IACpF;EACJ,CAAC;AAAA;AAED,OAAO,MAAM8C,kBAAkB,GAAGC,KAAA;EAAA,IAAC;IAAE9C,IAAI;IAAEkC;EAAG,CAAC,GAAAY,KAAA;EAAA,OAAK,MAAO5C,QAAQ,IAAK;IAEpEA,QAAQ,CAAC;MAAEC,IAAI,EAAEf,UAAU,CAACO,mBAAmB;MAAES,OAAO,EAAE8B;IAAG,CAAC,CAAC;IAC/D,IAAI;MACA,MAAMnD,aAAa,CAAE,gBAAemD,EAAG,EAAC,EAAElC,IAAI,CAACW,KAAK,CAAC;IACzD,CAAC,CAAC,OAAOC,GAAG,EAAE;MACVV,QAAQ,CAAC;QAAEC,IAAI,EAAEhB,WAAW,CAAC0B,KAAK;QAAET,OAAO,EAAE;UAAEU,KAAK,EAAEF,GAAG,CAACG,QAAQ,CAACC,IAAI,CAACjB;QAAI;MAAE,CAAC,CAAC;IACpF;EACJ,CAAC;AAAA"},"metadata":{},"sourceType":"module"}