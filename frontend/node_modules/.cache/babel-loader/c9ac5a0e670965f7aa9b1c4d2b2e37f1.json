{"ast":null,"code":"import { DeleteData, EditData } from \"../actions/globalTypes\";\nimport { MESS_TYPES } from \"../actions/messageAction\";\nconst initialState = {\n  //mảng data user add vào list chat\n  users: [],\n  resultUsers: 0,\n  //nội dung của mảng hội thoại\n  data: [],\n  // resultData: 0,\n  firstLoad: false\n};\nconst messageReducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n  switch (action.type) {\n    case MESS_TYPES.ADD_USER:\n      if (state.users.every(item => item._id !== action.payload._id)) {\n        return {\n          ...state,\n          users: [action.payload, ...state.users]\n        };\n        // dispatch({ type: MESS_TYPES.ADD_USER, payload: { ...user, text: '', media: [] } })\n      }\n\n      return state;\n    // return { ...state, users: [...state.users, action.payload] }\n    //     khác với  return { ...state, users: [action.payload, ...state.users] }, add vào thì nó hiện ngược lại list\n\n    case MESS_TYPES.ADD_MESSAGE:\n      return {\n        ...state,\n        // data: [...state.data, action.payload],\n        data: state.data.map(item => item._id === action.payload.recipient || item._id === action.payload.sender ? {\n          ...item,\n          messages: [...item.messages, action.payload],\n          result: item.result + 1\n        } : item),\n        users: state.users.map(user => user._id === action.payload.recipient || user._id === action.payload.sender ? {\n          ...user,\n          text: action.payload.text,\n          media: action.payload.media\n        } : user)\n      };\n    case MESS_TYPES.GET_CONVERSATIONS:\n      return {\n        ...state,\n        // users: [...state.users, action.payload]\n        users: action.payload.newArr,\n        //sau khi đã lọc\n        resultUsers: action.payload.result,\n        //lấy result từ ctrl\n        firstLoad: true\n      };\n    case MESS_TYPES.GET_MESSAGES:\n      return {\n        ...state,\n        // data: action.payload.messages.reverse(),\n        data: [...state.data, action.payload]\n        // resultData: action.payload.result,//lấy result từ ctrl\n      };\n\n    case MESS_TYPES.UPDATE_MESSAGES:\n      console.log(action.payload);\n      return {\n        ...state,\n        data: EditData(state.data, action.payload._id, action.payload)\n      };\n    case MESS_TYPES.DELETE_MESSAGES:\n      return {\n        ...state,\n        // chua thong tin mang moi, cap nhat mang moi, tim id\n        data: state.data.map(item => item._id === action.payload._id ? {\n          ...item,\n          messages: action.payload.newData\n        } : item)\n      };\n    case MESS_TYPES.DELETE_CONVERSATION:\n      return {\n        ...state,\n        users: DeleteData(state.users, action.payload),\n        data: DeleteData(state.data, action.payload)\n      };\n    case MESS_TYPES.CHECK_ONLINE_OFFLINE:\n      return {\n        ...state,\n        users: state.users.map(user => action.payload.includes(user._id) ? {\n          ...user,\n          online: true\n        } : {\n          ...user,\n          online: false\n        })\n      };\n    default:\n      return state;\n  }\n};\nexport default messageReducer;","map":{"version":3,"names":["DeleteData","EditData","MESS_TYPES","initialState","users","resultUsers","data","firstLoad","messageReducer","state","arguments","length","undefined","action","type","ADD_USER","every","item","_id","payload","ADD_MESSAGE","map","recipient","sender","messages","result","user","text","media","GET_CONVERSATIONS","newArr","GET_MESSAGES","UPDATE_MESSAGES","console","log","DELETE_MESSAGES","newData","DELETE_CONVERSATION","CHECK_ONLINE_OFFLINE","includes","online"],"sources":["D:/JoynetSocialNetwork/do-an-fe/src/redux/reducers/messageReducer.js"],"sourcesContent":["import { DeleteData, EditData } from \"../actions/globalTypes\";\r\nimport { MESS_TYPES } from \"../actions/messageAction\";\r\n\r\nconst initialState = {\r\n    //mảng data user add vào list chat\r\n    users: [],\r\n    resultUsers: 0,\r\n    //nội dung của mảng hội thoại\r\n    data: [],\r\n    // resultData: 0,\r\n    firstLoad: false\r\n}\r\n\r\nconst messageReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case MESS_TYPES.ADD_USER:\r\n            if (state.users.every(item => item._id !== action.payload._id)) {\r\n                return {\r\n                    ...state,\r\n                    users: [action.payload, ...state.users]\r\n                }\r\n                // dispatch({ type: MESS_TYPES.ADD_USER, payload: { ...user, text: '', media: [] } })\r\n            }\r\n            return state;\r\n        // return { ...state, users: [...state.users, action.payload] }\r\n        //     khác với  return { ...state, users: [action.payload, ...state.users] }, add vào thì nó hiện ngược lại list\r\n\r\n        case MESS_TYPES.ADD_MESSAGE:\r\n            return {\r\n                ...state,\r\n                // data: [...state.data, action.payload],\r\n                data: state.data.map(item =>\r\n                    item._id === action.payload.recipient || item._id === action.payload.sender\r\n                        ? {\r\n                            ...item,\r\n                            messages: [...item.messages, action.payload],\r\n                            result: item.result + 1\r\n                        }\r\n                        : item\r\n                ),\r\n                users: state.users.map(\r\n                    user => user._id === action.payload.recipient || user._id === action.payload.sender\r\n                        ? { ...user, text: action.payload.text, media: action.payload.media }\r\n                        : user\r\n                )\r\n            };\r\n        case MESS_TYPES.GET_CONVERSATIONS:\r\n            return {\r\n                ...state,\r\n                // users: [...state.users, action.payload]\r\n                users: action.payload.newArr,//sau khi đã lọc\r\n                resultUsers: action.payload.result,//lấy result từ ctrl\r\n                firstLoad: true\r\n            };\r\n\r\n        case MESS_TYPES.GET_MESSAGES:\r\n            return {\r\n                ...state,\r\n                // data: action.payload.messages.reverse(),\r\n                data: [...state.data, action.payload]\r\n                // resultData: action.payload.result,//lấy result từ ctrl\r\n            };\r\n        case MESS_TYPES.UPDATE_MESSAGES:\r\n            console.log(action.payload)\r\n            return {\r\n                ...state,\r\n                data: EditData(state.data, action.payload._id, action.payload)\r\n            };\r\n        case MESS_TYPES.DELETE_MESSAGES:\r\n            return {\r\n                ...state,\r\n                // chua thong tin mang moi, cap nhat mang moi, tim id\r\n                data: state.data.map(item =>\r\n                    item._id === action.payload._id\r\n                        ? { ...item, messages: action.payload.newData }\r\n                        : item\r\n                )\r\n            };\r\n        case MESS_TYPES.DELETE_CONVERSATION:\r\n            return {\r\n                ...state,\r\n                users: DeleteData(state.users, action.payload),\r\n                data: DeleteData(state.data, action.payload)\r\n            }\r\n        case MESS_TYPES.CHECK_ONLINE_OFFLINE:\r\n            return {\r\n                ...state,\r\n                users: state.users.map(user =>\r\n                    action.payload.includes(user._id) ? { ...user, online: true } : { ...user, online: false }\r\n                ),\r\n\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\n\r\nexport default messageReducer"],"mappings":"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"},"metadata":{},"sourceType":"module"}